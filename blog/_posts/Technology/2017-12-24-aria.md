---
layout: post
title: 可编程路由器打造自制 NAS + Aria 离线下载
categories: 
- Technology
tags:
- router
- disk
- aria

---

使用Apple TV 后，体会到了 NAS （网络附加存储：直接连接在电脑网络上面，对异质网络用户提供了集中式数据访问服务。）的重要性。利用家里的可编程路由器可以实现简单功能。

###1. 配置路由器

a. 挂载移动硬盘

        windows常见的 fat32 或者 ntfs 格式的硬盘，可是读取效率较低，建议先格式化成ext3或者ext4格式

<!--more-->

b. 打开路由器的 smb 网络共享

        梅林固件在「USB相关应用 - 服务器中心 - 网络共享」

<img src="http://7xo4c2.com1.z0.glb.clouddn.com/20171224110623_wOvD4W_Screenshot.jpeg" alter="" width="75%">

c. 测试PC&Mac访问

        如果配置成功，Mac 的共享/ PC 的网上邻居会有新的路由器设备。如果没有显示，也可以在 Mac 下打开Finder，前往服务器（快捷键 command+k），输入地址 smb://192.168.50.1 (我的路由器ip)。然后用你设置的账号密码登陆。
    
以上， __你家中所有的设备都可以通过访问 smb 来连接路由器上的外接硬盘，可以直接进行上传、下载、删除操作。__

另外，如果你使用的是 iOS/tvOS，强烈推荐你使用 Infuse 这个软件看视频。自动连接


###2. 连接 Aria2


Koolshare 的梅林固件提供了两个非常实用的功能，Aria2 和 DDNSTO内网穿透。

a. Aira2 可以直接下载文件到路由器的外接硬盘。

        安装好Aria2插件后，在下载存储目录下可以设置默认的下载目录。点击提交设定。

<img src="http://7xo4c2.com1.z0.glb.clouddn.com/20171224105922_S5Yflj_Screenshot.jpeg" alter="" width="75%">

        在内网中打开 Aria 控制台，如 http://aria2.me/webui-aria2/ 
        填好主机，端口和 token（从路由器插件中获取）

<img src="http://7xo4c2.com1.z0.glb.clouddn.com/20171224111655_d3GkK0_Screenshot.jpeg" alter="" width="75%">

        就能正常下载文件了。

b. DDDNSTO内网穿透可以在没有公网IP的情况下远程访问路由器

        具体远程配置方法可以查看[ DDNSTO远程控制使用教程（更新Aria2穿透设置）](http://koolshare.cn/forum.php?mod=viewthread&tid=116500&extra=page%3D1%26filter%3Dtypeid%26typeid%3D88)



PS：在设置好 aria2 ddns域名之后，可能需要登陆域名进行验证一次，才能在 aria2 上连接成功。

<img src="http://7xo4c2.com1.z0.glb.clouddn.com/20171224102007_kN39D5_Screenshot.jpeg" alter="" width="75%">

Aria 默认下载 BT 任务时，下载完成后，默认是需要上传量达到下载量才会停止做种，可以改变 --seed-ratio 参数控制上传比例。（拿一还一是美德）

###3. 更多客户端

Ariafred 是一个 Alfred Workflow，可以通过 Alfred 控制 Aria2 的大部分操作。

通过 aria rpc 添加 rpc 路径，需要把路径最后的 jsonrpc 改成 rpc

通过 aria token 添加 token

通过 aria 查看状态

<img src="http://7xo4c2.com1.z0.glb.clouddn.com/20171224115211_LgJ9vi_Screenshot.jpeg" alter="" width="75%">

通过 aria add 添加下载链接。



### References:
1. [【智能路由】用路由器低成本打造NAS+迅雷离线下载+同步android文件](https://luolei.org/openwrt-router-wifi-android-sync-iclould/)
2. [【公开内测】DDNSTO远程控制使用教程（更新Aria2穿透设置） - 插件 - KoolShare - 源于玩家 服务玩家](http://koolshare.cn/forum.php?mod=viewthread&tid=116500&extra=page%3D1%26filter%3Dtypeid%26typeid%3D88)
3. [Ariafred: 利用 Alfred 管理 Aria2 | Wildog](http://wil.dog/ariafred/)
4. [Aria2下载任务完成后不停止一直上传 - 梅林 - KoolShare - 源于玩家 服务玩家](http://koolshare.cn/thread-104721-1-1.html)
5. [yangshun1029/aria2gui: Aria2GUI for MAC OS X](https://github.com/yangshun1029/aria2gui)
6. [venj's blog: 用HFS+做文件系统实现Linux和Mac下文件共享](http://blog.venj.me/2011/01/hfslinuxmac.html)
